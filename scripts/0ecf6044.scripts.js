"use strict";angular.module("burnApp",["ui.router"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("main",{url:"/",templateUrl:"views/main.html",controller:"MainCtrl"}).state("milestones",{url:"/:owner/:repo/milestones",templateUrl:"views/milestones.html",controller:"MilestonesCtrl"}).state("milestones.burnup",{url:"/:number",templateUrl:"views/burnup.html",controller:"BurnUpCtrl"})}]),angular.module("burnApp").controller("MainCtrl",["$scope","$location",function(a,b){a.go=function(a){b.path(a+"/milestones")}}]),angular.module("burnApp").controller("BurnUpCtrl",["$scope","$stateParams","Issues","ChartData",function(a,b,c,d){var e=function(){var e=c.query(b.owner,b.repo,b.number);e.then(function(a){var b=d.formChartData(a);$("#chart").highcharts(b)},function(b){a.error=b.message})};e()}]),angular.module("burnApp").factory("Issues",["$q","$http",function(a,b){return{query:function(c,d,e){var f=a.defer();b.get("https://api.github.com/repos/"+c+"/"+d+"/issues?state=open&milestone="+e).success(function(a){f.resolve(a)}).error(function(a){h.reject(a)});var g=a.defer();b.get("https://api.github.com/repos/"+c+"/"+d+"/issues?state=closed&milestone="+e).success(function(a){g.resolve(a)}).error(function(a){h.reject(a)});var h=a.defer();return a.all([f.promise,g.promise]).then(function(a){var b=a[0].concat(a[1]);h.resolve(b)},function(a){h.reject(a)}),h.promise}}}]),angular.module("burnApp").controller("MilestonesCtrl",["$scope","$stateParams","Milestones","$state",function(a,b,c,d){var e=function(){if(void 0===a.milestones){var d=c.query(b.owner,b.repo);d.then(function(b){a.milestones=b},function(b){a.error=b.message})}};e(),a.go=function(a){d.go("milestones.burnup",{number:a})}}]),angular.module("burnApp").factory("Milestones",["$q","$http",function(a,b){var c=function(a){var b={};return angular.forEach(a,function(a){this[a.number]=a},b),b};return{query:function(d,e){var f=a.defer();b.get("https://api.github.com/repos/"+d+"/"+e+"/milestones?state=open").success(function(a){f.resolve(a)}).error(function(a){h.reject(a)});var g=a.defer();b.get("https://api.github.com/repos/"+d+"/"+e+"/milestones?state=closed").success(function(a){g.resolve(a)}).error(function(a){h.reject(a)});var h=a.defer();return a.all([f.promise,g.promise]).then(function(a){var b=a[0].concat(a[1]);0===b.length?h.reject({message:"No milestones."}):h.resolve(c(b))},function(a){h.reject(a)}),h.promise}}}]),angular.module("burnApp").factory("ChartData",["$q",function(){var a=function(a){angular.forEach(a,function(a){a.created_at=moment(a.created_at),null!==a.closed_at&&(a.closed_at=moment(a.closed_at))});var b,c={colors:["#4572A7","#89A54E"],title:{text:"Burn-up"},xAxis:{title:{text:"Date"},categories:[],labels:{enabled:!1}},yAxis:{title:{text:"Issues"},allowDecimals:!1},series:[{name:"Total",type:"line",step:"left",data:[]},{name:"Closed",type:"areaspline",data:[]}]},d=moment(a[0].milestone.created_at);if(null==a[0].milestone.due_on)b=moment();else{var e=moment(a[0].milestone.due_on),f=moment(a[0].milestone.updated_at);b=f.isAfter(e,"day")?f:e}for(var g=moment();!d.isAfter(b,"day");){c.xAxis.categories.push(d.format("ll"));var h=0,i=0,j=0;angular.forEach(a,function(a){(d.isSame(a.created_at,"day")||d.isAfter(a.created_at,"day"))&&(h++,"open"===a.state||d.isBefore(a.closed_at,"day")?i++:j++)}),d.isAfter(g,"day")||(c.series[0].data.push(h),c.series[1].data.push(j)),d.add("days",1)}return c.xAxis.min=0,c.xAxis.max=c.xAxis.categories.length-1,c};return{formChartData:a}}]);